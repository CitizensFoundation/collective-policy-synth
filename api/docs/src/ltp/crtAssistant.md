# Module: crtAssistant

This module provides functions for generating user prompts and system prompts for a chat interface that assists in creating a Current Reality Tree (CRT), a tool used in the Logical Thinking Process methodology. It includes functions for rendering prompts based on user input, system guidance, and refining causes based on a logical validation process. Additionally, it handles streaming responses from OpenAI's GPT model to WebSocket clients.

## Methods

| Name                              | Parameters                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Return Type | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-----------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| renderFirstUserPromptWithTree     | currentUserMessage: string, currentRealityTree: LtpCurrentRealityTreeData, parentNode: LtpCurrentRealityTreeDataNode, currentUDE: string, parentNodes: LtpCurrentRealityTreeDataNode[] \| undefined = undefined                                                                                                                                                                                                                                                                                                                     | string      | Generates the first user prompt including the current reality tree context, the undesirable effect (UDE), and the user's message. It formats the prompt to include the direct and intermediate causes of the UDE as described by the user and the tree structure.                                                                                                                                                                                                                                  |
| renderFirstUserPrompt             | effect: string, causes: string[], validationReview: string                                                                                                                                                                                                                                                                                                                                                                                                                   | string      | Creates a prompt based on the effect, its causes, and an expert validation review. This method is used to generate the initial prompt for the user, focusing on the effect and its causes without the context of the entire current reality tree.                                                                                                                                                                                                                                                  |
| renderSystemPrompt                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | string      | Generates a system prompt that provides guidelines for the user on how to contribute to creating a Current Reality Tree. This prompt includes instructions on refining causes, offering suggestions, and formatting responses.                                                                                                                                                                                                                                                                      |
| getRefinedCauses                  | crt: LtpCurrentRealityTreeData, clientId: string, wsClients: Map<string, WebSocket>, parentNode: LtpCurrentRealityTreeDataNode, currentUDE: string, chatLog: PsSimpleChatLog[], parentNodes: LtpCurrentRealityTreeDataNode[] \| undefined = undefined, customSystemPrompts: Map<number, string> \| undefined = undefined, effect?: string, causes?: string[], validationReview?: string                                                                                                                     | Promise<void> | Asynchronously refines causes based on user input and logical validation. It generates prompts for the user to refine their input and streams the responses from OpenAI's GPT model to the specified WebSocket client. This method is central to the interactive process of building a Current Reality Tree, allowing for dynamic updates based on user interaction and AI-generated suggestions. It handles the complexity of managing the conversation flow and ensuring that the user's input is logically consistent. |

## Examples

```typescript
import { renderFirstUserPromptWithTree, renderFirstUserPrompt, renderSystemPrompt, getRefinedCauses } from '@policysynth/apiltp/crtAssistant.js';

// Example usage of renderFirstUserPromptWithTree
const userPromptWithTree = renderFirstUserPromptWithTree("User's message", currentRealityTree, parentNode, "Current UDE");

// Example usage of renderFirstUserPrompt
const userPrompt = renderFirstUserPrompt("Effect", ["Cause1", "Cause2"], "Validation Review");

// Example usage of renderSystemPrompt
const systemPrompt = renderSystemPrompt();

// Example usage of getRefinedCauses
// Note: This is an asynchronous function and requires proper context to be fully demonstrated.
await getRefinedCauses(crtData, "clientId", wsClients, parentNode, "Current UDE", chatLog);
```
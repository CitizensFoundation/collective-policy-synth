{"version":3,"file":"yp-collection-items-grid.js","sourceRoot":"","sources":["../../../src/@yrpri/yp-collection/yp-collection-items-grid.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  html,\n  css,\n  nothing,\n  TemplateResult\n} from 'lit';\n\nimport {\n  property,\n  customElement\n} from 'lit/decorators.js';\n\nimport { YpBaseElement } from '../common/yp-base-element.js';\nimport { ShadowStyles } from '../common/ShadowStyles.js';\nimport { YpIronListHelpers } from '../common/YpIronListHelpers.js';\nimport { YpCollectionHelpers } from '../common/YpCollectionHelpers.js';\n//import { RangeChangedEvent } from '@lit-labs/virtualizer/Virtualizer.js';\nimport { LitVirtualizer } from '@lit-labs/virtualizer';\nimport { FlowLayout } from '@lit-labs/virtualizer/layouts/flow.js';\nimport { GridLayout } from '@lit-labs/virtualizer/layouts/grid.js';\n\nimport { YpCollectionItemCard } from './yp-collection-item-card.js';\nimport { YpServerApi } from '../common/YpServerApi.js';\nimport { ifDefined } from 'lit/directives/if-defined.js';\n\nimport './yp-collection-item-card.js';\n\n@customElement('yp-collection-items-grid')\nexport class YpCollectionItemsGrid extends YpBaseElement {\n  @property({ type: Object })\n  collection: YpCollectionData | undefined;\n\n  @property({ type: Array })\n  collectionItems: Array<YpCollectionData> | undefined;\n\n  @property({ type: String })\n  collectionItemType!: string;\n\n  @property({ type: Array })\n  sortedCollectionItems: Array<YpCollectionData> | undefined;\n\n  @property({ type: Boolean, reflect: true })\n  grid = false;\n\n  resetListSize: Function | undefined;\n  skipIronListWidth = false;\n\n  static get styles() {\n    return [\n      super.styles,\n      ShadowStyles,\n      css`\n        .card {\n          padding: 0;\n          padding-top: 24px;\n          width: 100%;\n        }\n\n        .card[wide-padding] {\n          padding: 16px !important;\n        }\n\n        a {\n          text-decoration: none;\n          width: 100%;\n        }\n      `,\n    ];\n  }\n\n  render() {\n    return this.sortedCollectionItems\n      ? html`\n          <lit-virtualizer\n            id=\"list\"\n            role=\"main\"\n            .layout=\"${this.grid ? GridLayout : FlowLayout}\"\n            aria-label=\"${this.t(this.pluralItemType)}\"\n            .items=\"${this.sortedCollectionItems}\"\n            .scrollTarget=\"${window}\"\n            .keyFunction=\"${(item: YpCollectionData) => item.id}\"\n            .renderItem=\"${this.renderItem.bind(this)}\"></lit-virtualizer>\n        `\n      : nothing;\n  }\n\n  renderItem(item: YpCollectionData, index: number): TemplateResult {\n    return html` <yp-collection-item-card\n      class=\"card\"\n      aria-label=\"${item.name}\"\n      ariarole=\"listitem\"\n      .item=\"${item}\"\n      @keypress=\"${this._keypress.bind(this)}\"\n      @click=\"${this._selectedItemChanged.bind(\n        this\n      )}\"></yp-collection-item-card>`;\n  }\n\n  get pluralItemType() {\n    if (this.collectionItemType=='community') {\n      return 'communities';\n    } else if (this.collectionItemType=='group') {\n      return 'groups';\n    } else if (this.collectionItemType=='post') {\n      return 'posts';\n    } else {\n      return 'unknownItemType';\n    }\n  }\n\n  _keypress(event: KeyboardEvent) {\n    if (event.keyCode==13) {\n      this._selectedItemChanged(event as unknown as CustomEvent);\n    }\n  }\n\n  async refresh() {}\n\n  firstUpdated(changedProperties: Map<string | number | symbol, unknown>) {\n    super.firstUpdated(changedProperties);\n    //TODO: Remove unknown cast\n    YpIronListHelpers.attachListeners(this as unknown as YpElementWithIronList);\n  }\n\n  async connectedCallback() {\n    super.connectedCallback();\n    if (this.collection && this.collectionItems) {\n      const splitCommunities = YpCollectionHelpers.splitByStatus(\n        this.collectionItems,\n        this.collection.configuration\n      );\n\n      this.sortedCollectionItems = splitCommunities.featured.concat(\n        splitCommunities.active.concat(splitCommunities.archived)\n      );\n    }\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    //TODO: Remove unknown cast\n    YpIronListHelpers.detachListeners(this as unknown as YpElementWithIronList);\n  }\n\n  // TODO: Make sure this fires each time on keyboard, mouse & phone - make sure back key on browser works also just with the A\n  _selectedItemChanged(event: CustomEvent) {\n    const item = (event.target as YpCollectionItemCard).item;\n\n    if (this.collectionItemType && item) {\n      window.appGlobals.activity(\n        'open',\n        this.collectionItemType,\n        `/${this.collectionItemType}/${item.id}`,\n        { id: item.id }\n      );\n\n      if (this.collectionItemType === 'community') {\n        const community = item as YpCommunityData;\n        if (community!=undefined) {\n          window.appGlobals.cache.backToDomainCommunityItems[\n            community.domain_id!\n          ] = community;\n        }\n      } else if (this.collectionItemType === 'group' && item) {\n        const group = item as YpGroupData;\n        window.appGlobals.cache.backToCommunityGroupItems[\n          group.community_id\n        ] = group;\n        window.appGlobals.cache.groupItemsCache[group.id] = group;\n      }\n    }\n  }\n\n  scrollToItem(item: YpDatabaseItem | undefined) {\n    if (item && this.sortedCollectionItems) {\n      for (let i = 0; i < this.sortedCollectionItems.length; i++) {\n        if (this.sortedCollectionItems[i] == item) {\n          (this.$$('#list') as LitVirtualizer).scrollToIndex(i);\n          break;\n        }\n      }\n      this.fireGlobal('yp-refresh-activities-scroll-threshold');\n    } else {\n      console.error('No item to scroll too');\n    }\n  }\n}\n"]}
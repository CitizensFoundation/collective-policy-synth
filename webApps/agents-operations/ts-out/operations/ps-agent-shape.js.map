{"version":3,"file":"ps-agent-shape.js","sourceRoot":"","sources":["../../src/operations/ps-agent-shape.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,GAAG,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,EAAE,MAAM,aAAa,CAAC;AAEnD,MAAM,OAAO,eAAgB,SAAQ,GAAG,CAAC,WAAW;IAClD,MAAM;QACJ,KAAK,CAAC,MAAM,EAAE,CAAC;QAEf,MAAM,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QAE5C,yBAAyB;QACzB,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,QAA4B,CAAC;QAEpE,IAAI,kBAAkB,GAAG,GAAG,CAAC;QAC7B,IAAI,mBAAmB,GAAG,GAAG,CAAC;QAE9B,IAAI,QAAQ,KAAK,WAAW,EAAE,CAAC;YAC7B,kBAAkB,GAAG,GAAG,CAAC;YACzB,mBAAmB,GAAG,GAAG,CAAC;QAC5B,CAAC;QAED,mDAAmD;QACnD,MAAM,aAAa,GAAG,CAAC,CAAC,eAAe,EAAE;YACvC,KAAK,EAAE,kBAAkB;YACzB,MAAM,EAAE,mBAAmB;YAC3B,KAAK,EAAE,oCAAoC;SAC5C,CAAC,CAAC,IAAI,CAAC;QAER,sCAAsC;QACtC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;QAEjC,4DAA4D;QAC5D,UAAU,CAAC,GAAG,EAAE;YACd,MAAM,GAAG,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;YAC1C,GAAG,CAAC,YAAY,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC;YAC1C,GAAG,CAAC,YAAY,CAAC,OAAO,EAAE,8BAA8B,CAAC,CAAC;YAE1D,IAAI,QAAQ,KAAK,OAAO,EAAE,CAAC;gBACzB,GAAG,CAAC,SAAS,GAAG;qBACH,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO;;sBAE5B,CAAC;gBACf,GAAG,CAAC,SAAS,GAAG,gBAAgB,CAAC;gBACjC,IAAI,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO,IAAI,GAAG,EAAE,CAAC;oBACzC,GAAG,CAAC,SAAS,IAAI,wBAAwB,CAAC;gBAC5C,CAAC;YACH,CAAC;iBAAM,CAAC;gBACN,GAAG,CAAC,SAAS,GAAG;yBACC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,WAAW;;2BAE/B,CAAC;gBACpB,GAAG,CAAC,SAAS,GAAG,oBAAoB,CAAC;YACvC,CAAC;YAED,sCAAsC;YACtC,aAAa,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;YAE/B,yCAAyC;YACzC,aAAa,CAAC,qBAAqB,EAAE,CAAC;QACxC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,yFAAyF;QAEhG,IAAI,CAAC,MAAM,EAAE,CAAC;QACd,OAAO,IAAI,CAAC;IACd,CAAC;CACF;AAED,MAAM,OAAO,UAAW,SAAQ,MAAM,CAAC,QAAQ,CAAC,SAAS;IAAzD;;QAYE,SAAI,GAAG,eAAe,CAAC;IACzB,CAAC;IAZC,QAAQ;QACN,OAAO,IAAI,CAAC,cAAc,CACxB;YACE,IAAI,EAAE,iBAAiB;YACvB,KAAK,EAAE,EAAE;YACT,MAAM,EAAE,aAAa;SACtB,EACD,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,SAAS,CAAC,QAAQ,CAC7C,CAAC;IACJ,CAAC;CAGF","sourcesContent":["import { dia, shapes, util, V } from '@joint/core';\n\nexport class AgentsShapeView extends dia.ElementView {\n  render() {\n    super.render();\n\n    const htmlMarkup = this.model.get('markup');\n\n    //TODO: Make TS work here\n    const nodeType = this.model.attributes.nodeType as PsAgentsNodeType;\n\n    let foreignObjectWidth = 200;\n    let foreignObjectHeight = 224;\n\n    if (nodeType === 'connector') {\n      foreignObjectWidth = 140;\n      foreignObjectHeight = 180;\n    }\n\n    // Create a foreignObject with a set size and style\n    const foreignObject = V('foreignObject', {\n      width: foreignObjectWidth,\n      height: foreignObjectHeight,\n      style: 'overflow: visible; display: block;',\n    }).node;\n\n    // Append the foreignObject to this.el\n    V(this.el).append(foreignObject);\n\n    // Defer the addition of the inner div with the HTML content\n    setTimeout(() => {\n      const div = document.createElement('div');\n      div.setAttribute('class', 'html-element');\n      div.setAttribute('xmlns', 'http://www.w3.org/1999/xhtml');\n\n      if (nodeType === 'agent') {\n        div.innerHTML = `<ps-agent-node\n          agentId=\"${this.model.attributes.agentId}\"\n        >\n     </ps-agent-node>`;\n        div.className = 'agentContainer';\n        if (this.model.attributes.agentId == \"2\") {\n          div.className += ' agentContainerRunning';\n        }\n      } else {\n        div.innerHTML = `<ps-connector-node\n          connectorId=\"${this.model.attributes.connectorId}\"\n        >\n      </ps-connector-node>`;\n        div.className = 'connectorContainer';\n      }\n\n      // Append the div to the foreignObject\n      foreignObject.appendChild(div);\n\n      // Force layout recalculation and repaint\n      foreignObject.getBoundingClientRect();\n    }, 0); // A timeout of 0 ms defers the execution until the browser has finished other processing\n\n    this.update();\n    return this;\n  }\n}\n\nexport class AgentShape extends shapes.standard.Rectangle {\n  defaults() {\n    return util.deepSupplement(\n      {\n        type: 'html.AgentShape',\n        attrs: {},\n        markup: '<div></div>',\n      },\n      shapes.standard.Rectangle.prototype.defaults\n    );\n  }\n\n  view = AgentsShapeView;\n}\n"]}
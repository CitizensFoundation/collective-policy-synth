{"version":3,"file":"ps-add-agent-dialog.js","sourceRoot":"","sources":["../../src/operations/ps-add-agent-dialog.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html, css } from 'lit';\nimport { customElement, property, state } from 'lit/decorators.js';\nimport { PsAiModelSize } from './aiModelTypes.js';\n\nimport '@material/web/dialog/dialog.js';\nimport '@material/web/button/text-button.js';\nimport '@material/web/button/filled-button.js';\nimport '@material/web/select/filled-select.js';\nimport '@material/web/select/select-option.js';\nimport '@material/web/textfield/filled-text-field.js';\n\nimport { OpsServerApi } from './OpsServerApi.js';\nimport { YpBaseElement } from '@yrpri/webapp/common/yp-base-element.js';\n\n@customElement('ps-add-agent-dialog')\nexport class PsAddAgentDialog extends YpBaseElement {\n  @property({ type: Boolean }) open = false;\n  @property({ type: Number }) parentAgentId: number;\n  @property({ type: Number }) groupId: number;\n\n  @state() private activeAgentClasses: PsAgentClassAttributes[] = [];\n  @state() private activeAiModels: PsAiModelAttributes[] = [];\n  @state() private selectedAgentClassId: number | null = null;\n  @state() private selectedAiModels: { [key in PsAiModelSize]?: number | null } = {};\n  @state() private agentName: string = '';\n\n  @state() private filteredAiModels: { [key in PsAiModelSize]: PsAiModelAttributes[] } = {\n    small: [],\n    medium: [],\n    large: []\n  };\n\n  private api = new OpsServerApi();\n\n  async connectedCallback() {\n    super.connectedCallback();\n    await this.fetchActiveAgentClasses();\n    await this.fetchActiveAiModels();\n  }\n\n  async fetchActiveAgentClasses() {\n    try {\n      this.activeAgentClasses = await this.api.getActiveAgentClasses();\n    } catch (error) {\n      console.error('Error fetching active agent classes:', error);\n    }\n  }\n\n  async fetchActiveAiModels() {\n    try {\n      this.activeAiModels = await this.api.getActiveAiModels();\n      this.filterAiModels();\n    } catch (error) {\n      console.error('Error fetching active AI models:', error);\n    }\n  }\n\n  filterAiModels() {\n    this.filteredAiModels = {\n      small: [],\n      medium: [],\n      large: []\n    };\n\n    this.activeAiModels.forEach(model => {\n      if (model.configuration && 'modelSize' in model.configuration) {\n        const size = model.configuration.modelSize as PsAiModelSize;\n        if (size in this.filteredAiModels) {\n          this.filteredAiModels[size].push(model);\n        }\n      }\n    });\n  }\n\n  render() {\n    return html`\n      <md-dialog ?open=\"${this.open}\" @closed=\"${this._handleClose}\">\n        <div slot=\"headline\">${this.t('addNewAgent')}</div>\n        <div slot=\"content\">\n          <md-filled-text-field\n            label=\"${this.t('agentName')}\"\n            @input=\"${this._handleNameInput}\"\n            value=\"${this.agentName}\"\n          ></md-filled-text-field>\n          <md-filled-select\n            label=\"${this.t('selectAgentClass')}\"\n            @change=\"${this._handleAgentClassSelection}\"\n          >\n            ${this.activeAgentClasses?.map(\n              agentClass => html`\n                <md-select-option value=\"${agentClass.id}\">\n                  <div slot=\"headline\">${agentClass.name}</div>\n                </md-select-option>\n              `\n            )}\n          </md-filled-select>\n          <div class=\"aiModelInfo\">\n            ${this.t(\"aiModelAgentCreateInfo\")}\n          </div>\n          ${this.renderAiModelSelect('small')}\n          ${this.renderAiModelSelect('medium')}\n          ${this.renderAiModelSelect('large')}\n        </div>\n        <div slot=\"actions\">\n          <md-text-button @click=\"${this._handleClose}\">${this.t('cancel')}</md-text-button>\n          <md-filled-button @click=\"${this._handleAddAgent}\">${this.t('addAgent')}</md-filled-button>\n        </div>\n      </md-dialog>\n    `;\n  }\n\n  getLocalizedModelLabel(size: PsAiModelSize) {\n    switch (size) {\n      case 'small':\n        return this.t(\"selectSmallAiModel\");\n      case 'medium':\n        return this.t(\"selectMediumAiModel\");\n      case 'large':\n        return this.t(\"selectLargeAiModel\");\n      default:\n        return this.t(\"selectAiModel\");\n    }\n  }\n\n  private renderAiModelSelect(size: PsAiModelSize) {\n    const models = this.filteredAiModels[size];\n    const isDisabled = models.length === 0;\n\n    return html`\n      <md-filled-select\n        .label=\"${this.getLocalizedModelLabel(size)}\"\n        @change=\"${(e: Event) => this._handleAiModelSelection(e, size)}\"\n        ?disabled=\"${isDisabled}\"\n      >\n        ${isDisabled\n          ? html`<md-select-option disabled>\n              <div slot=\"headline\">${this.t(\"noModelsAvailable\")}</div>\n            </md-select-option>`\n          : models.map(aiModel => html`\n              <md-select-option value=\"${aiModel.id}\">\n                <div slot=\"headline\">${aiModel.name}</div>\n              </md-select-option>\n            `)\n        }\n      </md-filled-select>\n    `;\n  }\n\n  private _handleNameInput(e: Event) {\n    const input = e.target as HTMLInputElement;\n    this.agentName = input.value;\n  }\n\n  private _handleAgentClassSelection(e: Event) {\n    const select = e.target as HTMLSelectElement;\n    this.selectedAgentClassId = Number(select.value);\n  }\n\n  private _handleAiModelSelection(e: Event, size: PsAiModelSize) {\n    const select = e.target as HTMLSelectElement;\n    this.selectedAiModels[size] = Number(select.value);\n  }\n\n  private _handleClose() {\n    this.dispatchEvent(new CustomEvent('close'));\n  }\n\n  private async _handleAddAgent() {\n    const selectedModels = Object.entries(this.selectedAiModels)\n      .filter(([_, value]) => value !== null)\n      .reduce((acc, [key, value]) => ({ ...acc, [key]: value }), {});\n\n    if (!this.agentName || !this.selectedAgentClassId || Object.keys(selectedModels).length === 0) {\n      console.error('Agent name, class, and at least one AI model must be selected');\n      return;\n    }\n\n    try {\n      const newAgent = await this.api.createAgent(\n        this.agentName,\n        this.selectedAgentClassId,\n        selectedModels as { [key: string]: number },\n        this.parentAgentId,\n        this.groupId\n      );\n      this.dispatchEvent(\n        new CustomEvent('agent-added', { detail: { agent: newAgent } })\n      );\n      this._handleClose();\n    } catch (error) {\n      console.error('Error creating new agent:', error);\n    }\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        md-filled-text-field,\n        md-filled-select {\n          width: 100%;\n          margin-bottom: 16px;\n          margin-top: 16px;\n        }\n\n        .aiModelInfo {\n          margin-top: 16px;\n          margin-bottom: 8px;\n          font-size: var(--md-sys-typescale-label-medium-size);\n        }\n      `,\n    ];\n  }\n}"]}
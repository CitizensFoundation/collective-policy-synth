{"version":3,"file":"ps-operations-manager.js","sourceRoot":"","sources":["../../src/operations/ps-operations-manager.ts"],"names":[],"mappings":"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","sourcesContent":["import { PropertyValueMap, css, html, nothing } from 'lit';\nimport { property, customElement, query } from 'lit/decorators.js';\n\nimport { cache } from 'lit/directives/cache.js';\nimport { resolveMarkdown } from '../chatBot/litMarkdown.js';\n\nimport '@material/web/iconbutton/icon-button.js';\nimport '@material/web/progress/linear-progress.js';\nimport '@material/web/tabs/tabs.js';\nimport '@material/web/tabs/primary-tab.js';\nimport '@material/web/textfield/outlined-text-field.js';\nimport '@material/web/iconbutton/outlined-icon-button.js';\nimport '@material/web/button/filled-tonal-button.js';\nimport '@material/web/dialog/dialog.js';\nimport '@material/web/button/text-button.js';\nimport '@material/web/checkbox/checkbox.js';\nimport '@material/web/menu/menu.js';\nimport '@material/web/menu/menu-item.js';\n\nimport { MdOutlinedTextField } from '@material/web/textfield/outlined-text-field.js';\n\nimport '@material/web/button/filled-button.js';\n\nimport { MdTabs } from '@material/web/tabs/tabs.js';\n\nimport './ps-operations-view.js';\nimport './OpsServerApi.js';\nimport { OpsServerApi } from './OpsServerApi.js';\n\nimport './chat/agent-chat-assistant.js';\nimport { MdDialog } from '@material/web/dialog/dialog.js';\nimport { OpsStreamingAIResponse } from './OpsStreamingAIResponse.js';\nimport { PsOperationsView } from './ps-operations-view.js';\nimport { YpBaseElement } from '@yrpri/webapp/common/yp-base-element.js';\nimport '@yrpri/webapp/yp-survey/yp-structured-question-edit.js';\n\nimport { PsOperationsBaseNode } from './ps-operations-base-node.js';\nimport { YpStructuredQuestionEdit } from '@yrpri/webapp/yp-survey/yp-structured-question-edit.js';\n\nconst TESTING = false;\n\nconst nodeTypes = [\n  'agent',\n  'connector'\n];\n\n@customElement('ps-operations-manager')\nexport class PsOperationsManager extends YpBaseElement {\n  @property({ type: Number })\n  currentAgentId: number | undefined;\n\n  @property({ type: Object })\n  currentAgent: PsAgentInstance | undefined;\n\n  @property({ type: Boolean })\n  isFetchingAgent = false;\n\n  @property({ type: Object })\n  nodeToEditInfo: PsAgentInstance | PsAgentConnectorInstance | undefined;\n\n  @property({ type: Object })\n  nodeToEdit: PsOperationsBaseNode | undefined;\n\n  @property({ type: Array })\n  allCausesExceptCurrentToEdit: PsOperationsBaseNode[] = [];\n\n  @property({ type: Boolean })\n  showDeleteConfirmation = false;\n\n  @property({ type: Number })\n  activeTabIndex = 0;\n\n  @property({ type: String })\n  currentlySelectedCauseIdToAddAsChild: string | undefined;\n\n  @property({ type: String })\n  AIConfigReview: string | undefined;\n\n  @property({ type: Boolean })\n  isReviewingAgent = false;\n\n  @property({ type: Boolean })\n  isCreatingAgent = false;\n\n  @query('ps-operations-view')\n  agentElement!: PsOperationsView;\n\n  api: OpsServerApi;\n\n  @property({ type: Object })\n  nodeToAddCauseTo: PsOperationsBaseNode | undefined;\n  wsMessageListener: ((event: any) => void) | undefined = undefined;\n\n  currentStreaminReponse: OpsStreamingAIResponse | undefined;\n\n  constructor() {\n    super();\n    this.api = new OpsServerApi();\n    this.setupTestData();\n  }\n\n  setupTestData() {\n\n  }\n\n  override async connectedCallback() {\n    super.connectedCallback();\n    this.addEventListener(\n      'open-add-cause-dialog',\n      this.openAddCauseDialog as EventListenerOrEventListenerObject\n    );\n\n    this.addEventListener(\n      'close-add-cause-dialog',\n      this.closeAddCauseDialog as EventListenerOrEventListenerObject\n    );\n\n    if (this.currentAgentId) {\n      this.fetchCurrentAgent();\n    }\n\n    this.addEventListener(\n      'edit-node',\n      this.openEditNodeDialog as EventListenerOrEventListenerObject\n    );\n  }\n\n  openEditNodeDialog(event: CustomEvent) {\n    this.nodeToEditInfo = event.detail.element;\n\n    this.currentlySelectedCauseIdToAddAsChild = undefined;\n\n    /*this.nodeToEdit = this.findNodeRecursively(\n      this.currentAgent?.subAgents || [],\n      this.nodeToEditInfo!.nodeId\n    );\n    if (!this.nodeToEdit) {\n      console.error(`Could not find node ${this.nodeToEditInfo!.nodeId}`);\n      console.error(JSON.stringify(this.currentAgent, null, 2));\n      return;\n    }\n\n    const childrenIds = (this.nodeToEdit.children || []).map(\n      (child) => child.id\n    );\n    childrenIds.push(this.nodeToEdit.id);\n\n    this.allCausesExceptCurrentToEdit =\n      this.agentElement!.getAllCausesExcept(childrenIds);*/\n\n    (this.$$('#editNodeDialog') as MdDialog).show();\n  }\n\n  saveAnswers() {\n    const answers: Record<string, YpStructuredAnswer> = {};\n    for (\n      let a = 0;\n      a < this.nodeToEditInfo.class.configurationQuestions.length;\n      a++\n    ) {\n      const questionElement = this.$$(\n        '#structuredQuestion_' + a\n      ) as YpStructuredQuestionEdit;\n      if (questionElement) {\n        const answer = questionElement.getAnswer();\n        if (answer && questionElement.question.uniqueId) {\n          answers[questionElement.question.uniqueId] = answer;\n        }\n      }\n    }\n    this.nodeToEditInfo.configuration = answers;\n  }\n\n  closeEditNodeDialog() {\n    (this.$$('#editNodeDialog') as MdDialog).close();\n    this.nodeToEdit = undefined;\n    this.nodeToEditInfo = undefined;\n  }\n\n  addChildChanged() {\n    const effectIdSelect = this.$$('#addEffectToNodeId') as HTMLSelectElement;\n    this.currentlySelectedCauseIdToAddAsChild = effectIdSelect.value;\n  }\n\n  async handleSaveEditNode() {\n    this.saveAnswers();\n    this.closeEditNodeDialog();\n\n    if (this.currentAgentId) {\n      try {\n        await this.api.updateNode(this.currentAgentId, this.nodeToEdit);\n\n        // Update the node in the agent object\n        /*const nodeToUpdate = this.findNodeRecursively(\n            this.currentAgent?.subAgents || [],\n            this.nodeToEdit.id\n          );\n          if (nodeToUpdate) {\n            nodeToUpdate.description = updatedDescription;\n            if (selectedNodeType) {\n              nodeToUpdate.type = selectedNodeType as AgentNodeType;\n            }\n          }*/\n\n        this.closeEditNodeDialog();\n        //TODO: Do this with less brute force, actually update the element\n        this.currentAgent = { ...this.currentAgent };\n      } catch (error) {\n        console.error('Error updating node:', error);\n      }\n    }\n  }\n\n  handleDeleteNode() {\n    this.showDeleteConfirmation = true;\n  }\n\n  removeNodeRecursively(nodes: PsOperationsBaseNode[], nodeId: string) {\n    const index = nodes.findIndex(node => node.id === nodeId);\n    if (index !== -1) {\n      nodes.splice(index, 1);\n      return;\n    }\n    nodes.forEach(node => {\n      if (node.children) {\n        //this.removeNodeRecursively(node.subAgents, nodeId);\n      }\n    });\n  }\n\n  async confirmDeleteNode() {\n    if (this.nodeToEdit && this.currentAgentId) {\n      try {\n        await this.api.deleteNode(this.currentAgentId, this.nodeToEdit.id);\n\n        // Remove the node from the agent object\n        // this.removeNodeRecursively(this.currentAgent?.subAgents || [], this.nodeToEdit.id);\n        this.closeEditNodeDialog();\n        this.currentAgent = { ...this.currentAgent };\n      } catch (error) {\n        console.error('Error deleting node:', error);\n      } finally {\n        this.closeDeleteConfirmationDialog();\n      }\n    }\n  }\n\n  createDirectCauses() {\n    if (this.nodeToEditInfo) {\n      //this.nodeToEditInfo.element.createDirectCauses();\n    }\n\n    this.closeEditNodeDialog();\n  }\n  closeDeleteConfirmationDialog() {\n    this.showDeleteConfirmation = false;\n  }\n\n  renderDeleteConfirmationDialog() {\n    return html`\n      <md-dialog\n        id=\"deleteConfirmationDialog\"\n        ?open=\"${this.showDeleteConfirmation}\"\n        @closed=\"${() => (this.showDeleteConfirmation = false)}\"\n      >\n        <div slot=\"headline\">Confirm Deletion</div>\n        <div slot=\"content\">Are you sure you want to delete this node?</div>\n        <div slot=\"actions\">\n          <md-text-button @click=\"${this.closeDeleteConfirmationDialog}\">\n            Cancel\n          </md-text-button>\n          <md-text-button @click=\"${this.confirmDeleteNode}\">\n            Delete\n          </md-text-button>\n        </div>\n      </md-dialog>\n    `;\n  }\n\n  _saveNodeEditState(event: CustomEvent) {}\n\n  renderNodeEditHeadline() {\n    return html`\n      <div class=\"layout horizontal\">\n        <div>\n          <img\n            src=\"${this.nodeToEditInfo.class.imageUrl}\"\n            class=\"nodeEditHeadlineImage\"\n          />\n        </div>\n        <div class=\"nodeEditHeadlineTitle\">\n          ${this.nodeToEditInfo.class.name}\n        </div>\n      </div>\n    `;\n  }\n\n  renderEditNodeDialog() {\n    let initiallyLoadedAnswers = [] as any;\n\n    if (this.nodeToEditInfo) {\n      // convert this.nodeToEditInfo.configuration object to array only with the values\n      initiallyLoadedAnswers = Object.values(\n        this.nodeToEditInfo.configuration\n      );\n    }\n\n    return html`\n      <md-dialog\n        id=\"editNodeDialog\"\n        style=\"width: 800px; max-height: 90vh;\"\n        @closed=\"${this.closeEditNodeDialog}\"\n      >\n        <div slot=\"headline\">\n          ${this.nodeToEditInfo ? this.renderNodeEditHeadline() : ''}\n        </div>\n        <div\n          slot=\"content\"\n          id=\"editNodeForm\"\n          style=\"max-height: 90vh;height: 500px;\"\n          class=\"layout vertical\"\n        >\n          ${this.nodeToEditInfo\n            ? html`\n                <div id=\"surveyContainer\">\n                  ${this.nodeToEditInfo.class.configurationQuestions.map(\n                    (question, index) => html`\n                      <yp-structured-question-edit\n                        index=\"${index}\"\n                        id=\"structuredQuestion_${question.uniqueId ? index : `noId_${index}`}\"\n                        .structuredAnswers=\"${initiallyLoadedAnswers}\"\n                        @changed=\"${this._saveNodeEditState}\"\n                        .question=\"${question}\"\n                      >\n                      </yp-structured-question-edit>\n                    `\n                  )}\n                </div>\n              `\n            : nothing}\n        </div>\n        <div slot=\"actions\">\n          <md-text-button\n            hidden\n            @click=\"${this.handleDeleteNode}\"\n            class=\"deleteButton\"\n          >\n            Delete\n          </md-text-button>\n          <div class=\"flex\"></div>\n          <md-text-button @click=\"${this.closeEditNodeDialog}\" value=\"cancel\">\n            Cancel\n          </md-text-button>\n          <md-text-button @click=\"${this.handleSaveEditNode}\" value=\"ok\">\n            Save\n          </md-text-button>\n        </div>\n      </md-dialog>\n    `;\n  }\n\n  updatePath() {\n    const dontDoIt = false;\n    if (!dontDoIt) {\n      if (this.currentAgent && this.currentAgent.id) {\n        window.history.pushState({}, '', `/agent/${this.currentAgent.id}`);\n      } else {\n        console.error('Could not fetch current tree: ' + this.currentAgentId);\n      }\n    }\n  }\n\n  async fetchCurrentAgent() {\n    this.isFetchingAgent = true;\n\n    //this.currentAgent = undefined; //  await this.api.getAgent(this.currentAgentId as number);\n\n    this.isFetchingAgent = false;\n\n    if (false && this.currentAgent) {\n      this.updatePath();\n\n      await this.updateComplete;\n\n      (this.$$('#context') as MdOutlinedTextField).value =\n        this.currentAgent.class.description;\n      (this.$$('#undesirableEffects') as MdOutlinedTextField).value = '';\n\n      this.activeTabIndex = 1;\n      (this.$$('#tabBar') as MdTabs).activeTabIndex = 1;\n    }\n  }\n\n  override updated(\n    changedProperties: Map<string | number | symbol, unknown>\n  ): void {\n    super.updated(changedProperties);\n  }\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this.removeEventListener(\n      'open-add-cause-dialog',\n      this.openAddCauseDialog as EventListenerOrEventListenerObject\n    );\n    this.removeEventListener(\n      'close-add-cause-dialog',\n      this.closeAddCauseDialog as EventListenerOrEventListenerObject\n    );\n  }\n  camelCaseToHumanReadable(str: string) {\n    // Split the string at each uppercase letter and join with space\n    const words = str.replace(/([A-Z])/g, ' $1').trim();\n\n    // Capitalize the first letter of the resulting string\n    return words.charAt(0).toUpperCase() + words.slice(1);\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        md-tabs {\n          margin-bottom: 64px;\n        }\n\n        .nodeEditHeadlineImage {\n          max-width: 100px;\n          margin-right: 16px;\n        }\n\n        .nodeEditHeadlineTitle {\n          display: flex;\n          align-items: center;\n          justify-content: center; /* This will also center the content horizontally */\n          height: 55px; /* Make sure this element has a defined height */\n        }\n\n        .childEditing {\n          color: var(--md-sys-color-on-surface-variant);\n          background-color: var(--md-sys-color-surface-variant);\n          padding: 16px;\n          border-radius: 8px;\n        }\n\n        .childrenList {\n          height: 100px;\n          overflow-y: auto;\n        }\n\n        md-icon-button {\n          margin-top: 32px;\n        }\n\n        .createOptionsButtons {\n          display: flex;\n          justify-content: center;\n          position: absolute;\n          bottom: 0;\n          left: 0;\n          right: 0;\n          padding-left: 8px;\n          padding-right: 8px;\n        }\n\n        .deleteButton {\n          --md-sys-color-primary: var(--md-sys-color-error);\n        }\n\n        md-circular-progress {\n          margin-bottom: 6px;\n        }\n\n        md-filled-text-field,\n        md-outlined-text-field {\n          width: 600px;\n          margin-bottom: 16px;\n        }\n\n        [type='textarea'] {\n          min-height: 150px;\n        }\n\n        [type='textarea'][supporting-text] {\n          min-height: 76px;\n        }\n\n        .formContainer {\n          margin-top: 32px;\n        }\n\n        md-filled-button,\n        md-outlined-button {\n          margin-top: 8px;\n          margin-left: 8px;\n          margin-right: 8px;\n          margin-bottom: 8px;\n        }\n\n        .aiConfigReview {\n          margin-left: 8px;\n          margin-right: 8px;\n          padding: 16px;\n          margin-top: 8px;\n          margin-bottom: 8px;\n          border-radius: 12px;\n          max-width: 560px;\n          font-size: 14px;\n          background-color: var(--md-sys-color-primary-container);\n          color: var(--md-sys-color-on-primary-container);\n        }\n\n        .agentUDEDescription {\n          font-size: 18px;\n          margin: 32px;\n          margin-bottom: 0;\n          padding: 24px;\n          border-radius: 12px;\n          background-color: var(--md-sys-color-primary);\n          color: var(--md-sys-color-on-primary);\n        }\n\n        md-tabs,\n        agent-tab,\n        configure-tab {\n          width: 100%;\n        }\n\n        .themeToggle {\n          margin-top: 32px;\n        }\n\n        ltp-chat-assistant {\n          height: 100%;\n          max-height: 100%;\n          width: 100%;\n          height: 100%;\n        }\n\n        md-linear-progress {\n          width: 600px;\n        }\n\n        .darkModeButton {\n          margin-right: 8px;\n          margin-left: 8px;\n        }\n\n        .topDiv {\n          margin-bottom: 256px;\n        }\n\n        md-outlined-select {\n          z-index: 1500px;\n          margin: 16px;\n          margin-left: 0;\n          max-width: 250px;\n        }\n\n        .automaticCreateButton {\n          max-width: 300px;\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n      `,\n    ];\n  }\n\n  tabChanged() {\n    this.activeTabIndex = (this.$$('#tabBar') as MdTabs).activeTabIndex;\n  }\n\n  clearForNew() {\n    this.currentAgent = undefined;\n    this.currentAgentId = undefined;\n    this.AIConfigReview = undefined;\n    (this.$$('#context') as MdOutlinedTextField).value = '';\n    (this.$$('#undesirableEffects') as MdOutlinedTextField).value = '';\n    //window.history.pushState({}, '', `/agent`);\n  }\n\n  get agentInputData() {\n    return {\n      description:\n        (this.$$('#description') as MdOutlinedTextField)?.value ?? '',\n      context: (this.$$('#context') as MdOutlinedTextField).value ?? '',\n      undesirableEffects:\n        (this.$$('#undesirableEffects') as MdOutlinedTextField).value.split(\n          '\\n'\n        ) ?? [],\n      nodes: [],\n    } as any; //LtpCurrentRealityAgentData;\n  }\n\n  async reviewAgentConfiguration() {\n    this.isReviewingAgent = true;\n\n    if (this.currentStreaminReponse) {\n      this.currentStreaminReponse.close();\n    }\n\n    if (this.wsMessageListener) {\n      this.removeEventListener('wsMessage', this.wsMessageListener);\n    }\n\n    this.AIConfigReview = undefined;\n\n    this.currentStreaminReponse = new OpsStreamingAIResponse(this);\n\n    try {\n      const wsClientId = await this.currentStreaminReponse.connect();\n      this.AIConfigReview = '';\n      console.log('Connected with clientId:', wsClientId);\n\n      this.wsMessageListener = (event: any) => {\n        const { data } = event.detail;\n        if (data.type === 'part' && data.text) {\n          this.AIConfigReview += data.text;\n        } else if (data.type === 'end') {\n          this.removeListener('wsMessage', this.wsMessageListener!);\n          this.wsMessageListener = undefined;\n          this.currentStreaminReponse = undefined;\n          this.isReviewingAgent = false;\n        }\n      };\n\n      this.addEventListener('wsMessage', this.wsMessageListener);\n\n      await this.api.reviewConfiguration(wsClientId, this.agentInputData);\n\n      // Proceed with your logic\n    } catch (error) {\n      console.error('WebSocket connection failed:', error);\n      this.removeListener('wsMessage', this.wsMessageListener!);\n    }\n  }\n\n  async createAgent() {\n    this.isCreatingAgent = true;\n\n    const agentSeed = this.agentInputData;\n\n    if (TESTING && (this.$$('#context') as MdOutlinedTextField).value == '') {\n      agentSeed.context =\n        'We are a software company with a product we have as as service';\n      agentSeed.undesirableEffects = ['End users are unhappy with the service'];\n    }\n\n    //this.currentAgent = await this.api.createAgent(agentSeed);\n\n    this.updatePath();\n\n    this.isCreatingAgent = false;\n    this.activeTabIndex = 1;\n    (this.$$('#tabBar') as MdTabs).activeTabIndex = 1;\n  }\n\n  toggleDarkMode() {\n    this.fire('yp-theme-dark-mode', !this.themeDarkMode);\n    window.psAppGlobals.activity('Agent - toggle darkmode');\n    if (this.themeDarkMode) {\n      window.psAppGlobals.activity('Settings - dark mode');\n      localStorage.setItem('md3-ps-dark-mode', 'true');\n    } else {\n      window.psAppGlobals.activity('Settings - light mode');\n      localStorage.removeItem('md3-ps-dark-mode');\n    }\n  }\n\n  randomizeTheme() {\n    // Create a random hex color\n    const randomColor = Math.floor(Math.random() * 16777215).toString(16);\n    // Set the theme color\n    this.fire('yp-theme-color', `#${randomColor}`);\n  }\n\n  renderAIConfigReview() {\n    return html`\n      <div class=\"aiConfigReview\" id=\"aiConfigReview\">\n        ${this.AIConfigReview\n          ? html`\n              ${resolveMarkdown(this.AIConfigReview, {\n                includeImages: true,\n                includeCodeBlockClassNames: true,\n              })}\n            `\n          : nothing}\n      </div>\n    `;\n  }\n\n  renderReviewAndSubmit() {\n    return html`\n      <md-outlined-button\n        @click=\"${this.reviewAgentConfiguration}\"\n        ?hidden=\"${!this.AIConfigReview || this.currentAgent != undefined}\"\n        >${this.t('Review CRT again')}<md-icon slot=\"icon\"\n          >rate_review</md-icon\n        ></md-outlined-button\n      >\n      <md-filled-button\n        @click=\"${this.reviewAgentConfiguration}\"\n        ?hidden=\"${this.AIConfigReview != undefined ||\n        this.currentAgent != undefined}\"\n        ?disabled=\"${this.isReviewingAgent}\"\n        >${this.t('Review CRT')}<md-icon slot=\"icon\"\n          >rate_review</md-icon\n        ></md-filled-button\n      >\n    `;\n  }\n\n  renderThemeToggle() {\n    return html`<div class=\"layout horizontal center-center themeToggle\">\n      ${!this.themeDarkMode\n        ? html`\n            <md-outlined-icon-button\n              class=\"darkModeButton\"\n              @click=\"${this.toggleDarkMode}\"\n              ><md-icon>dark_mode</md-icon></md-outlined-icon-button\n            >\n          `\n        : html`\n            <md-outlined-icon-button\n              class=\"darkModeButton\"\n              @click=\"${this.toggleDarkMode}\"\n              ><md-icon>light_mode</md-icon></md-outlined-icon-button\n            >\n          `}\n\n      <md-outlined-icon-button\n        class=\"darkModeButton\"\n        @click=\"${this.randomizeTheme}\"\n        ><md-icon>shuffle</md-icon></md-outlined-icon-button\n      >\n    </div> `;\n  }\n\n  renderConfiguration() {\n    return html`\n      <div class=\"layout vertical center-center topDiv\">\n        ${this.renderThemeToggle()}\n\n        <div class=\"formContainer\">\n          <div>\n            <md-outlined-text-field\n              type=\"textarea\"\n              label=\"Context\"\n              id=\"context\"\n            ></md-outlined-text-field>\n          </div>\n\n          <div>\n            <md-outlined-text-field\n              type=\"textarea\"\n              label=\"Undesirable Effects\"\n              id=\"undesirableEffects\"\n            ></md-outlined-text-field>\n          </div>\n\n          <div class=\"layout horizontal center-center\">\n            <md-outlined-button\n              @click=\"${this.clearForNew}\"\n              ?hidden=\"${!this.currentAgent}\"\n              >${this.t('Create New Agent')}<md-icon slot=\"icon\"\n                >rate_review</md-icon\n              ></md-outlined-button\n            >\n\n            ${this.renderReviewAndSubmit()}\n\n            <md-filled-button\n              @click=\"${this.createAgent}\"\n              ?hidden=\"${!this.AIConfigReview ||\n              this.currentAgent != undefined}\"\n              ?disabled=\"${this.isReviewingAgent}\"\n              >${this.t('Create CRT')}<md-icon slot=\"icon\"\n                >send</md-icon\n              ></md-filled-button\n            >\n          </div>\n\n          ${this.isReviewingAgent && !this.AIConfigReview\n            ? html`<md-linear-progress indeterminate></md-linear-progress>`\n            : nothing}\n          ${this.AIConfigReview ? this.renderAIConfigReview() : nothing}\n        </div>\n      </div>\n    `;\n  }\n\n  /*findNodeRecursively = (\n    nodes: LtpCurrentRealityAgentDataNode[],\n    nodeId: string\n  ): LtpCurrentRealityAgentDataNode | undefined => {\n    for (const node of nodes) {\n      if (node.id === nodeId) {\n        return node;\n      }\n      if (node.children) {\n        const foundNode = this.findNodeRecursively(node.children, nodeId);\n        if (foundNode) {\n          return foundNode;\n        }\n      }\n    }\n    return undefined;\n  };*/\n\n  openAddCauseDialog(event: CustomEvent) {\n    console.error(`openAddCauseDialog ${event.detail.parentNodeId}`);\n    const parentNodeId = event.detail.parentNodeId;\n    // Get the node from the tree recursively\n\n    // Find the node recursively\n    /* const node = this.findNodeRecursively(this.currentAgent?.nodes || [], parentNodeId);\n    if (!node) {\n      console.error(`Could not find node ${parentNodeId}`);\n      console.error(JSON.stringify(this.currentAgent, null, 2));\n      return;\n    }\n    this.nodeToAddCauseTo = node;\n    (this.$$(\"#addCauseDialog\") as MdDialog).show();*/\n  }\n\n  closeAddCauseDialog() {\n    (this.$$('#addCauseDialog') as MdDialog).close();\n    this.nodeToAddCauseTo = undefined;\n  }\n\n  renderAddCauseDialog() {\n    return html`\n      <md-dialog\n        id=\"addCauseDialog\"\n        style=\"max-width: 800px;max-height: 90vh;\"\n        @closed=\"${this.closeAddCauseDialog}\"\n      >\n        <div slot=\"headline\">${/*this.nodeToAddCauseTo?.description*/ ''}</div>\n        <div slot=\"content\" class=\"chatContainer\">\n          ${this.nodeToAddCauseTo\n            ? html`\n                <ltp-chat-assistant\n                  .nodeToAddCauseTo=\"${this.nodeToAddCauseTo}\"\n                  method=\"dialog\"\n                  .textInputLabel=\"${this.t(\n                    'Enter sufficent direct causes to the effect'\n                  )}\"\n                  .agentData=\"${this.currentAgent}\"\n                  @close=\"${this.closeAddCauseDialog}\"\n                >\n                </ltp-chat-assistant>\n              `\n            : nothing}\n        </div>\n      </md-dialog>\n    `;\n  }\n\n  render(): any {\n    if (this.isFetchingAgent) {\n      return html`<md-linear-progress indeterminate></md-linear-progress>`;\n    } else {\n      return cache(html`\n        ${this.renderAddCauseDialog()} ${this.renderEditNodeDialog()}\n        ${this.renderDeleteConfirmationDialog()}\n        <md-tabs id=\"tabBar\" @change=\"${this.tabChanged}\">\n          <md-primary-tab id=\"configure-tab\" aria-controls=\"configure-panel\">\n            <md-icon slot=\"icon\">support_agent</md-icon>\n            ${this.t('Agents Operations')}\n          </md-primary-tab>\n          <md-primary-tab id=\"crt-tab\" aria-controls=\"crt-panel\" +>\n            <md-icon slot=\"icon\">checklist</md-icon>\n            ${this.t('Audit Log')}\n          </md-primary-tab>\n          <md-primary-tab id=\"crt-tab\" aria-controls=\"crt-panel\" +>\n            <md-icon slot=\"icon\">account_balance</md-icon>\n            ${this.t('Costs')}\n          </md-primary-tab>\n        </md-tabs>\n        <ps-operations-view\n          .currentAgent=\"${this.currentAgent}\"\n        ></ps-operations-view>\n      `);\n    }\n  }\n}\n"]}